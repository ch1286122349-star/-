<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEO æ•°æ®ä»ªè¡¨æ¿ | å¢¨è¥¿å“¥ä¸­æ–‡ç½‘</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 30px;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
      color: #1a1a1a;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
    }
    .stat-card:nth-child(2) {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    .stat-card:nth-child(3) {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    .stat-card:nth-child(4) {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }
    .stat-label {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
    }
    .table-container {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    thead {
      background: #f8f9fa;
    }
    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: #495057;
      border-bottom: 2px solid #dee2e6;
    }
    td {
      padding: 12px;
      border-bottom: 1px solid #e9ecef;
    }
    tr:hover {
      background: #f8f9fa;
    }
    .query-cell {
      font-weight: 500;
      color: #1a1a1a;
      max-width: 300px;
    }
    .url-cell {
      color: #666;
      font-size: 12px;
      max-width: 400px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .number-cell {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }
    .position-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 13px;
    }
    .position-good {
      background: #d4edda;
      color: #155724;
    }
    .position-medium {
      background: #fff3cd;
      color: #856404;
    }
    .position-bad {
      background: #f8d7da;
      color: #721c24;
    }
    .ctr-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    .ctr-zero {
      background: #f8d7da;
      color: #721c24;
    }
    .ctr-low {
      background: #fff3cd;
      color: #856404;
    }
    .ctr-good {
      background: #d4edda;
      color: #155724;
    }
    .filter-bar {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .filter-bar input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      flex: 1;
      max-width: 300px;
    }
    .filter-bar select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    .highlight {
      background: #fff3cd;
      padding: 2px 4px;
      border-radius: 3px;
    }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
    .last-updated {
      text-align: right;
      color: #999;
      font-size: 12px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ SEO æ•°æ®ä»ªè¡¨æ¿</h1>
    <p class="subtitle">æ•°æ®æ¥æºï¼šGoogle Search Console API</p>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">æ€»ç‚¹å‡»æ¬¡æ•°</div>
        <div class="stat-value" id="totalClicks">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">æ€»å±•ç¤ºæ¬¡æ•°</div>
        <div class="stat-value" id="totalImpressions">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">å¹³å‡ CTR</div>
        <div class="stat-value" id="avgCTR">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">å¹³å‡æ’å</div>
        <div class="stat-value" id="avgPosition">-</div>
      </div>
    </div>

    <div class="filter-bar">
      <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢å…³é”®è¯...">
      <select id="sortSelect">
        <option value="impressions">æŒ‰å±•ç¤ºæ¬¡æ•°æ’åº</option>
        <option value="clicks">æŒ‰ç‚¹å‡»æ¬¡æ•°æ’åº</option>
        <option value="ctr">æŒ‰ CTR æ’åº</option>
        <option value="position">æŒ‰æ’åæ’åº</option>
      </select>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>æœç´¢å…³é”®è¯</th>
            <th>é¡µé¢ URL</th>
            <th class="number-cell">æ’å</th>
            <th class="number-cell">å±•ç¤ºæ¬¡æ•°</th>
            <th class="number-cell">ç‚¹å‡»æ¬¡æ•°</th>
            <th class="number-cell">CTR</th>
          </tr>
        </thead>
        <tbody id="dataTable">
          <tr>
            <td colspan="6" class="empty-state">åŠ è½½ä¸­...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="last-updated" id="lastUpdated"></div>
  </div>

  <script>
    // åŠ è½½ GSC æ•°æ®
    async function loadData() {
      try {
        const response = await fetch('/data/gsc-data.json');
        const data = await response.json();
        
        // æ›´æ–°æ€»ä½“ç»Ÿè®¡
        document.getElementById('totalClicks').textContent = data.summary.clicks.toLocaleString();
        document.getElementById('totalImpressions').textContent = data.summary.impressions.toLocaleString();
        document.getElementById('avgCTR').textContent = (data.summary.ctr * 100).toFixed(2) + '%';
        document.getElementById('avgPosition').textContent = data.summary.position.toFixed(1);
        
        // æ˜¾ç¤ºæœ€åæ›´æ–°æ—¶é—´
        const endDate = new Date(data.dateRange.endDate);
        document.getElementById('lastUpdated').textContent = 
          `æ•°æ®æ›´æ–°æ—¶é—´ï¼š${endDate.toLocaleDateString('zh-CN')} (${data.dateRange.startDate} è‡³ ${data.dateRange.endDate})`;
        
        // æ¸²æŸ“è¡¨æ ¼
        renderTable(data.queries);
        
        // è®¾ç½®æœç´¢å’Œæ’åº
        setupFilters(data.queries);
      } catch (error) {
        document.getElementById('dataTable').innerHTML = 
          '<tr><td colspan="6" class="empty-state">âŒ æ— æ³•åŠ è½½æ•°æ®ã€‚è¯·ç¡®ä¿å·²è¿è¡Œ <code>node scripts/gsc_fetch_data.js</code></td></tr>';
      }
    }

    function renderTable(queries, searchTerm = '') {
      const tbody = document.getElementById('dataTable');
      
      if (!queries || queries.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state">æš‚æ— æ•°æ®</td></tr>';
        return;
      }

      // è¿‡æ»¤æ•°æ®
      let filteredQueries = queries;
      if (searchTerm) {
        filteredQueries = queries.filter(q => 
          q.keys[0].toLowerCase().includes(searchTerm.toLowerCase()) ||
          q.keys[1].toLowerCase().includes(searchTerm.toLowerCase())
        );
      }

      if (filteredQueries.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state">æœªæ‰¾åˆ°åŒ¹é…çš„å…³é”®è¯</td></tr>';
        return;
      }

      tbody.innerHTML = filteredQueries.map(query => {
        const keyword = query.keys[0];
        const url = query.keys[1];
        const position = query.position;
        const impressions = query.impressions;
        const clicks = query.clicks;
        const ctr = query.ctr;

        // æ’åå¾½ç« æ ·å¼
        let positionClass = 'position-bad';
        if (position <= 3) positionClass = 'position-good';
        else if (position <= 10) positionClass = 'position-medium';

        // CTR å¾½ç« æ ·å¼
        let ctrClass = 'ctr-zero';
        let ctrDisplay = (ctr * 100).toFixed(2) + '%';
        if (ctr === 0) {
          ctrClass = 'ctr-zero';
          ctrDisplay = '0%';
        } else if (ctr < 0.05) {
          ctrClass = 'ctr-low';
        } else {
          ctrClass = 'ctr-good';
        }

        // é«˜äº®æœç´¢è¯
        let displayKeyword = keyword;
        if (searchTerm) {
          const regex = new RegExp(`(${searchTerm})`, 'gi');
          displayKeyword = keyword.replace(regex, '<span class="highlight">$1</span>');
        }

        return `
          <tr>
            <td class="query-cell">${displayKeyword}</td>
            <td class="url-cell" title="${url}">${url.replace('https://mxchino.com', '')}</td>
            <td class="number-cell">
              <span class="position-badge ${positionClass}">#${position.toFixed(1)}</span>
            </td>
            <td class="number-cell">${impressions.toLocaleString()}</td>
            <td class="number-cell">${clicks.toLocaleString()}</td>
            <td class="number-cell">
              <span class="ctr-badge ${ctrClass}">${ctrDisplay}</span>
            </td>
          </tr>
        `;
      }).join('');
    }

    function setupFilters(queries) {
      const searchInput = document.getElementById('searchInput');
      const sortSelect = document.getElementById('sortSelect');

      let currentQueries = [...queries];

      // æœç´¢åŠŸèƒ½
      searchInput.addEventListener('input', (e) => {
        renderTable(currentQueries, e.target.value);
      });

      // æ’åºåŠŸèƒ½
      sortSelect.addEventListener('change', (e) => {
        const sortBy = e.target.value;
        currentQueries = [...queries].sort((a, b) => {
          if (sortBy === 'position') return a.position - b.position;
          return b[sortBy] - a[sortBy];
        });
        renderTable(currentQueries, searchInput.value);
      });

      // é»˜è®¤æŒ‰å±•ç¤ºæ¬¡æ•°æ’åº
      currentQueries.sort((a, b) => b.impressions - a.impressions);
    }

    // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
    loadData();
  </script>
</body>
</html>
